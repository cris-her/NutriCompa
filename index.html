<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>NutriCompa</title>
        <link rel="icon" type="image/png" href="nutriCompa.png">

        <!--<style>
            body {
                font-family: Arial, sans-serif;
            }

            form {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
            }

            form div {
                display: flex;
                align-items: center;
            }

            form label {
                margin-right: 5px;
            }

            form input,
            form select {
                margin-right: 10px;
            }

            #resultado {
                text-align: center;
                margin-top: 20px;
            }
        </style> --> 
        <style>
            .table-container {
                overflow-x: auto; /* Permite el desplazamiento horizontal */
                max-width: 100%; /* Establece el ancho máximo */
            }

            .invisible-button {
                visibility: hidden;
            }

            .shopping-lists {
                display: flex;
            }

            .shopping-list {
                flex: 1;
                margin-right: 20px; /* Espacio entre las listas */
            }

            /* Estilo adicional para las listas de compras */
            .shopping-list ul {
                list-style-type: none;
                padding: 0;
            }

            /* CSS to disable the table */
            /* #planificacion.disabled {
                pointer-events: none;  Disable pointer events 
                opacity: 0.5; Optionally adjust opacity to visually indicate disabled state 
            } */
            .disabled {
                pointer-events: none;
                opacity: 0.6; /* Optional: This will visually indicate that the table is disabled */
            }

            #calculoRequerimiento {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                max-width: 600px;
                margin: 0 auto;
                padding: 20px;
                border: 1px solid #ccc;
                border-radius: 5px;
            }
        
            #calculoRequerimiento div {
                /* flex: 0 0 48%; */
                flex: 0 0 calc(33.333% - 10px); /* Cambiado el ancho para que ocupe un tercio del espacio disponible */
                /* margin-bottom: 10px; */
            }
        
            #calculoRequerimiento label {
                display: block;
                font-weight: bold;
                margin-bottom: 5px;
            }
        
            #calculoRequerimiento input,
            #calculoRequerimiento select {
                width: calc(100% - 10px);
                padding: 5px;
                border: 1px solid #ccc;
                border-radius: 3px;
            }
        
            #calculoRequerimiento button {
                width: 100%;
                padding: 10px;
                background-color: #FF76BF;
                color: white;
                border: none;
                border-radius: 3px;
                cursor: pointer;
            }
        
            #resultado {
                margin-top: 20px;
                text-align: center;
                font-weight: bold;
            }
        </style> 
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f8f8f8;
            }

            h1,
            h2 {
                color: #333;
                text-align: center;
                margin-bottom: 20px;
            }

            /* form {
                margin-bottom: 20px;
                text-align: center;
            } */

            label {
                display: block;
                margin-bottom: 5px;
            }

            input[type="number"] {
                width: 100px;
                padding: 8px;
                margin-bottom: 10px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

            .form-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .form-row label {
                flex: 1;
                margin-right: 10px;
            }

            .form-row input[type="number"] {
                flex: 2;
            }

            button {
                padding: 10px 20px;
                background-color: #FF9CCA;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }

            th,
            td {
                padding: 10px;
                text-align: center;
                border-bottom: 1px solid #ddd;
            }

            th {
                background-color: #FF9CCA;
                color: white;
            }

            tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            td[contenteditable="true"] {
                background-color: #fff;
                cursor: pointer;
            }

            ul {
                list-style-type: none;
                padding: 0;
                margin: 0;
            }

            li {
                margin-bottom: 10px;
            }
        </style>
        <style>
            /* Estilos para la ventana modal */
            .modal {
                display: none;
                position: fixed;
                z-index: 1;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.4);
            }

            .modal-content {
                background-color: #fefefe;
                margin: 15% auto;
                padding: 20px;
                border: 1px solid #888;
                width: 80%;
            }
        </style>
            <style>
                /* Estilos para el contenedor de los radio buttons */
                #radio-container {
                    text-align: center;
                    margin-top: 5px;
                    margin-bottom: 10px;

                }
        
                /* Estilos para los radio buttons */
                #radio-container input[type="radio"] {
                    display: none;
                }


        
                #radio-container label {
                    display: inline-block;
                    width: 15px;
                    height: 15px;
                    border-radius: 50%;
                    background-color: #ccc;
                    margin: 0 10px;
                    cursor: pointer;
                }
        
                /* Estilos para cuando un radio button está seleccionado */
                /* #radio-container input[type="radio"]:checked + label {
                    background-color: #FF9CCA;
                } */
/* 
                /* Estilos para el radio azul cuando está seleccionado */
                #radio-container input.blue:checked + label {
                    background-color: #09D6DB;
                }

                /* Estilos para el radio verde cuando está seleccionado */
                #radio-container input.green:checked + label {
                    background-color: #48BF3B;
                }

                /* Estilos para el radio rojo cuando está seleccionado */
                #radio-container input.red:checked + label {
                    background-color: #FF3B3B;
                }

                .button-container {
                    margin-top: 20px;
                }
                /* Estilos para los botones adicionales */
                /* #button-container {
                    text-align: center;
                    margin-top: 20px;
 
                    display: flex; 
                }

                #button-container button {
                    padding: 10px 20px; 
                    margin: 0 10px;
                    cursor: pointer;
                } */
                /* #button-container {
                    display: flex;
                    justify-content: space-between; Distribuye los botones equitativamente en el contenedor 
                    margin-top: 20px; Añade un margen superior para separar los botones del resto del formulario 
                }

                #button-container button {
                    flex: 1; Los botones ocuparán todo el espacio disponible horizontalmente 
                    padding: 10px; Añade relleno para hacer los botones más grandes 
                    border: none; Quita el borde de los botones 
                    background-color: #FF9CCA; Color de fondo 
                    color: white; Color del texto 
                    cursor: pointer; Cambia el cursor al pasar sobre los botones 
                    border-radius: 5px; Añade bordes redondeados 
                    transition: background-color 0.3s; Agrega una transición suave para el cambio de color de fondo
                }

                #button-container button:hover {
                    background-color: #45a049; Cambia el color de fondo al pasar el mouse sobre los botones
                } */

            </style>
    </head>

    <body>
        <div id="radio-container">
            <input class="blue" checked type="radio" id="radio1" name="radios" onclick="clearAll()">
            <label for="radio1"></label>
        
            <input class="green" type="radio" id="radio2" name="radios" onclick="handleRadioChange('c')">
            <label for="radio2"></label>
        
            <input class="red" type="radio" id="radio3" name="radios" onclick="handleRadioChange('a')">
            <label for="radio3"></label>
        </div>

        <!-- <h1>Calculadora de Requerimiento Calórico</h1> -->
        <form id="calculoRequerimiento" onsubmit="calcularCalorias(); return false;">
            <div>
                <label for="edad">Edad:</label>
                <input value="30" type="number" id="edad" name="edad" required>
            </div>
            <div>
                <label for="altura">Altura (cm):</label>
                <input value="150" type="number" id="altura" name="altura" required>
            </div>

            <div>
                <label for="peso">Peso (kg):</label>
                <input value="50" type="number" id="peso" name="peso" required>
            </div>

            <div>
                <label for="sexo">Sexo:</label>
                <select id="sexo" name="sexo" required>
                    <option value="mujer">Mujer</option>
                    <option value="hombre">Hombre</option>
                </select>
            </div>

            <div>
                <label for="ejercicio">Nivel de ejercicio:</label>
                <select id="ejercicio" name="ejercicio" required>
                    <option value="sedentario">Poco o ningún ejercicio</option>
                    <option value="ligero">Ejercicio ligero (1-3 días por semana)</option>
                    <option value="moderado">Ejercicio Moderado (3-5 días por semana)</option>
                    <option value="fuerte">Ejercicio Fuerte (6 días por semana)</option>
                    <option value="profesional">Ejercicio profesional o extremo</option>
                </select>
            </div>
            <div>
                <label for="objetivo">Objetivo:</label>
                <select id="objetivo" name="objetivo" required>
                    <option value="mantener">Mantener peso (45% C, 30% P, 25% G)</option>
                    <option value="bajar">Bajar de peso  (40% C, 35% P, 25% G)</option>
                    <option value="aumentar">Aumentar masa muscular  (55% C, 20% P, 25% G)</option>
                </select>
            </div>
            <div class="button-container">
                <button id="saveBtn" class="invisible-button" onclick="save()">Guardar</button>
            </div>
            <div class="button-container">
                <button id="caloriasRequeridas" type="submit">Calcular</button>
            </div>
            <div class="button-container">
                <button id="copyBtn" class="invisible-button" onclick="copy()">Copiar</button>
            </div>
        </form>
        <div id="resultado"></div> 

        <div class="table-container">
        <!-- <h2>Planificación Semanal de Comidas</h2> -->
        <table class="disabled" id="planificacion">
            <thead>
                <tr>
                    <th></th>
                    <th>L</th>
                    <th>M</th>
                    <th>M</th>
                    <th>J</th>
                    <th>V</th>
                    <th>S</th>
                    <th>D</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>🥞</td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                </tr>
                <tr>
                    <td>🥛</td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                </tr>
                <tr>
                    <td>🍜</td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                </tr>
                <tr>
                    <td>🍦</td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                </tr>
                <tr>
                    <td>🍣</td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this)"></td>
                </tr>
                <tr>
                    <td>=</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>🧮</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        </div>

        <!-- Ventana Modal -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <!-- <p>Contenido de la ventana modal.</p> -->
                <h2>Selecciona una receta:</h2>
                <ul id="recipe-list"></ul>
            </div>
        </div>

        <h2>Preparación</h2>
        <ul id="listaInstrucciones">
        </ul>

        <h2>Lista de compras</h2>
        <!-- <ul id="listaCompras">
        </ul> -->
        <div class="shopping-lists">
            <div class="shopping-list">
                <h2>=</h2>
                <ul id="listaCompras">
                    <!-- Elementos de la lista de compras 1 -->
                </ul>
            </div>
            <div class="shopping-list">
                <h2>🧮</h2>
                <ul id="listaCompras2">
                    <!-- Elementos de la lista de compras 2 -->
                </ul>
            </div>
            <div id="acList" style="display: none;" class="shopping-list">
                <h2>= ac</h2>
                <ul id="listaCompras3">
                    <!-- Elementos de la lista de compras 3 -->
                </ul>
            </div>
            <div id="acAlgorithmList" style="display: none;" class="shopping-list">
                <h2>🧮 ac</h2>
                <ul id="listaCompras4">
                    <!-- Elementos de la lista de compras 4 -->
                </ul>
            </div>
        </div>
        

        <script>
            // Variable para almacenar si algún campo ha cambiado
            //let camposCambiados = false;

            // Obtener todos los campos del formulario
            const camposFormulario = document.querySelectorAll("#calculoRequerimiento input, #calculoRequerimiento select");

            // Agregar un controlador de eventos change a cada campo
            camposFormulario.forEach(campo => {
                campo.addEventListener("change", () => {
                    //camposCambiados = true;
                    document.getElementById('caloriasRequeridas').click();//submit
                    //cleanResult()
                    document.getElementById('saveBtn').disabled = false;
                    document.getElementById('copyBtn').disabled = true;
                    document.getElementById('saveBtn').style.background = '#FF9CCA';
                    document.getElementById('copyBtn').style.background = 'lightgray';

                    generateInstructionsAndIngredients();//!!!!!!
                });
            });

            function cleanResult(){
                document.getElementById("caloriasRequeridas").textContent = "Calcular";
            }

            function updateTotals() {
                // Obtener la tabla y las filas de la tabla
                let table = document.getElementById("planificacion").getElementsByTagName("tbody")[0];
                let rows = table.getElementsByTagName("tr");

                // Array para los días de la semana
                let daysOfWeek = ["lunes", "martes", "miércoles", "jueves", "viernes", "sábado", "domingo"];

                // Iterar sobre cada columna (día)
                for (let i = 1; i < rows[0].cells.length; i++) { // Empezamos desde 1 para omitir la primera celda (nombre de la comida)
                    // Variables para almacenar los totales de calorías, carbohidratos, proteínas y grasas
                    let totalCalories = 0;
                    let totalCarbohydrates = 0;
                    let totalProteins = 0;
                    let totalFats = 0;

                    // Iterar sobre cada fila (comida)
                    for (let j = 0; j < rows.length - 1; j++) {
                        // Obtener el nombre de la receta del ID de la celda
                        let recipeName = rows[j].cells[i].id;

                        // Verificar si la celda contiene una receta
                        if (recipeName !== "") {
                            //alert(recipeName)

                            // Buscar la receta en la lista de recetas
                            let recipe = recipes.find(recipe => recipe.name === recipeName);

                            // Si se encuentra la receta
                            if (recipe) {
                                //alert('recipe')
                                // Iterar sobre los ingredientes de la receta
                                recipe.ingredients.forEach(ingredient => {
                                    //alert(ingredient.name)
                                    // Buscar el alimento correspondiente al ingrediente
                                    let food = foods.find(food => food.name === ingredient.name);
                                    if (food) {
                                        //alert('food')
                                        // Buscar el grupo al que pertenece el alimento
                                        let group = groups.find(group => group.name === food.group);
                                        if (group) {
                                            //alert('group')
                                            // Calcular el total de calorías, carbohidratos, proteínas y grasas
                                            
                                            // let portion = parseFloat(ingredient.portion);
                                            // totalCalories += (portion * parseFloat(group.energy));
                                            // totalCarbohydrates += (portion * parseFloat(group.carbohydrates));
                                            // totalProteins += (portion * parseFloat(group.proteins));
                                            // totalFats += (portion * parseFloat(group.fat));

                                            // let portion = parseFloat(ingredient.portion);

                                            // // Calcular el factor de ajuste para las calorías y los macronutrientes
                                            // let adjustFactor = portion / parseFloat(food.portion);

                                            // // Ajustar las calorías y los macronutrientes según el factor de ajuste
                                            // totalCalories += (adjustFactor * parseFloat(group.energy));
                                            // totalCarbohydrates += (adjustFactor * parseFloat(group.carbohydrates));
                                            // totalProteins += (adjustFactor * parseFloat(group.proteins));
                                            // totalFats += (adjustFactor * parseFloat(group.fat));

                                            // Calcular el factor de ajuste
                                            
                                            let adjustFactor = parseFloat(ingredient.portion) / parseFloat(food.portion);
                                            //alert(`${ingredient.name} ${parseFloat(ingredient.portion)} ${parseFloat(food.portion)} ${adjustFactor}`)
                                            // Calcular las calorías ajustadas según el factor de ajuste
                                            let adjustedCalories = parseFloat(group.energy) * adjustFactor;
                                            // Calcular los carbohidratos ajustados según el factor de ajuste
                                            let adjustedCarbohydrates = parseFloat(group.carbohydrates) * adjustFactor;
                                            // Calcular las proteínas ajustadas según el factor de ajuste
                                            let adjustedProteins = parseFloat(group.proteins) * adjustFactor;
                                            // Calcular las grasas ajustadas según el factor de ajuste
                                            let adjustedFats = parseFloat(group.fat) * adjustFactor;
                                            // Sumar las calorías ajustadas a totalCalories
                                            totalCalories += adjustedCalories;
                                            // Sumar los carbohidratos ajustados a totalCarbohydrates
                                            totalCarbohydrates += adjustedCarbohydrates;
                                            // Sumar las proteínas ajustadas a totalProteins
                                            totalProteins += adjustedProteins;
                                            // Sumar las grasas ajustadas a totalFats
                                            totalFats += adjustedFats;
                                        }
                                    }
                                });
                            }
                        }
                    }

                    // Actualizar la celda de Total para el día correspondiente con los totales calculados
                    let totalCell = rows[rows.length - 2].cells[i];
                    //totalCell.textContent = `Calorías: ${totalCalories.toFixed(2)}, Carbohidratos: ${totalCarbohydrates.toFixed(2)}g, Proteínas: ${totalProteins.toFixed(2)}g, Grasas: ${totalFats.toFixed(2)}g`;
                    // Calcular el valor de los macronutrientes en kilocalorías
                    let macros = (totalCarbohydrates.toFixed(2) * 4) + (totalProteins.toFixed(2) * 4) + (totalFats.toFixed(2) * 9)
                    
                    // Obtener las calorías requeridas del usuario
                    //alert(user.calories);
                    let userCalories = user.calories;

                    // Establecer el estilo de la celda dependiendo de los valores de calorías requeridas, calorías totales y macronutrientes
                    if (userCalories < totalCalories.toFixed(2) && userCalories < macros) {
                        totalCell.style.backgroundColor = '#FF3B3B'; //red // Si las calorías requeridas son menores que las calorías totales o los macronutrientes, establecer el fondo rojo
                    } else if (userCalories >= totalCalories.toFixed(2) && userCalories <= macros) {
                        totalCell.style.backgroundColor = '#48BF3B';  //green // Si las calorías requeridas son mayores o iguales a las calorías totales y los macronutrientes, establecer el fondo verde
                    } else {
                        totalCell.style.backgroundColor = '#09D6DB'; //blue // Si no se cumple ninguna de las condiciones anteriores, establecer el fondo azul
                    }
                    
                    totalCell.innerHTML = `
                        <span style="font-size: 80%; color: #333;">
                            Calorías (avg): <strong>${totalCalories.toFixed(2)}</strong>,<br> 
                            Macronutrientes (Kcal): <strong>${macros.toFixed(2)}</strong>,<br> 
                            Carbohidratos (avg): <strong>${totalCarbohydrates.toFixed(2)}g</strong>,<br>
                            Proteínas (avg): <strong>${totalProteins.toFixed(2)}g</strong>,<br> 
                            Grasas (avg): <strong>${totalFats.toFixed(2)}g</strong>
                        </span>
                    `;

                    // Actualizar la celda de Total para el día correspondiente con los totales calculados
                    let algorithmCell = rows[rows.length - 1].cells[i];
                    //totalCell.textContent = `Calorías: ${totalCalories.toFixed(2)}, Carbohidratos: ${totalCarbohydrates.toFixed(2)}g, Proteínas: ${totalProteins.toFixed(2)}g, Grasas: ${totalFats.toFixed(2)}g`;
                    let algorithmMacros = (totalCarbohydrates.toFixed(2) * 4) + (totalProteins.toFixed(2) * 4) + (totalFats.toFixed(2) * 9)
                    algorithmCell.innerHTML = `
                        <span style="font-size: 80%; color: #333;">
                            Calorías: <strong>${totalCalories.toFixed(2)}</strong>,<br> 
                            Carbohidratos: <strong>${totalCarbohydrates.toFixed(2)}g</strong>,<br>
                            Proteínas: <strong>${totalProteins.toFixed(2)}g</strong>,<br> 
                            Grasas: <strong>${totalFats.toFixed(2)}g</strong>
                        </span>                     
                    `;

                }
            }



        </script>

        <script>
            var currentUser;

            function handleRadioChange(usr) {
                currentUser = usr;

                let url = "https://jsonfileapi.onrender.com/"+usr;
                //let url = "http://127.0.0.1:5000/"+usr;

                makeRequest(url);

                // Mostrar los botones cuando se selecciona el segundo o tercer radio button
                document.getElementById('saveBtn').style.visibility = 'visible';
                document.getElementById('copyBtn').style.visibility = 'visible';
                document.getElementById('saveBtn').disabled = true;
                document.getElementById('copyBtn').disabled = true;
                document.getElementById('saveBtn').style.background = 'lightgray';
                document.getElementById('copyBtn').style.background = 'lightgray';

                document.getElementById('acList').style.display = 'block';
                document.getElementById('acAlgorithmList').style.display = 'block';

                
            }

            function save() {
                // Lógica para el botón "Guardar"
                console.log('Guardando...');

                // Recopilar información del formulario
                var formData = {
                    age: document.getElementById('edad').value,
                    exercise: document.getElementById('ejercicio').value,
                    height: document.getElementById('altura').value,
                    objective: document.getElementById('objetivo').value,
                    weight: document.getElementById('peso').value,
                    sex: document.getElementById('sexo').value
                };

                /*
                let daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                let meals = ["breakfast", "brunch", "lunch", "snack", "dinner"];

                // Recopilar información de la tabla
                var tableData = {};
                var table = document.getElementById('planificacion');
                var rows = table.getElementsByTagName('tr');
                for (var i = 1; i < rows.length - 1; i++) {
                    var row = rows[i];
                    var cells = row.getElementsByTagName('td');
                    var meal = meals[i-1]; // Obtener el nombre de la comida usando el índice
                    tableData[meal.toLowerCase()] = {};
                    for (var j = 1; j < cells.length; j++) {
                        var day = daysOfWeek[j-1]; // Obtener el nombre del día usando el índice
                        tableData[meal.toLowerCase()][day] = cells[j].innerText;
                    }
                }
                */
                let daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                let meals = ["breakfast", "brunch", "lunch", "snack", "dinner"];

                // Recopilar información de la tabla
                let tableData = {};
                let table = document.getElementById('planificacion');
                let rows = table.getElementsByTagName('tr');
                for (let j = 1; j < rows[0].cells.length; j++) {
                    let day = daysOfWeek[j-1]; // Obtener el nombre del día usando el índice
                    tableData[day.toLowerCase()] = {};
                    //-2 because the last two are total and algorithm
                    for (let i = 1; i < rows.length - 2; i++) {
                        let row = rows[i];
                        let cells = row.getElementsByTagName('td');
                        let meal = meals[i-1]; // Obtener el nombre de la comida usando el índice
                        //alert(meal)
                        tableData[day.toLowerCase()][meal.toLowerCase()] = cells[j].id//cells[j].innerText;
                    }
                }
                //console.log(user.allIngredients)
                //alert(user.allIngredients)


                // Construir el objeto JSON
                var jsonData = {
                    menu: tableData,
                    profile: formData,
                    shopping: user.allIngredients
                };

                console.log(jsonData)

                // Enviar la solicitud HTTP POST
                fetch(`https://jsonfileapi.onrender.com/${currentUser}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Data saved successfully:', data);
                    // Hacer algo con la respuesta si es necesario
                })
                .catch(error => {
                    console.error('Error saving data:', error);
                });


                document.getElementById('saveBtn').disabled = true;
                document.getElementById('copyBtn').disabled = false;
                document.getElementById('saveBtn').style.background = 'lightgray';
                document.getElementById('copyBtn').style.background = '#FF9CCA';

                alert("Guardado!")
            }

            function copy() {
                // Lógica para el botón "Copiar"
                console.log('Copiando...');

                //document.getElementById('saveBtn').disabled = true;
                document.getElementById('copyBtn').disabled = true;
                //document.getElementById('saveBtn').style.background = 'lightgray';
                document.getElementById('copyBtn').style.background = 'lightgray';
            }

            function makeRequest(url) {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", url, true);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        fillForm(response.profile);
                        fillTable(response.menu);
                        //totalss
                        document.getElementById('caloriasRequeridas').click();//submit
                        //alert('generate')
                        generateInstructionsAndIngredients();//!!!!!!
                        //updateTotals();
                    }
                };
                xhr.send();
            }
        
            function fillForm(profile) {
                document.getElementById('edad').value = profile.age;
                document.getElementById('altura').value = profile.height;
                document.getElementById('peso').value = profile.weight;
                document.getElementById('sexo').value = profile.sex;
                document.getElementById('ejercicio').value = profile.exercise;
                document.getElementById('objetivo').value = profile.objective;

                calcularCalorias();
                
            }

            function clearAll() {
                document.getElementById('edad').value = "30";
                document.getElementById('altura').value = "150";
                document.getElementById('peso').value = "50";
                document.getElementById('sexo').value = "mujer";
                document.getElementById('ejercicio').value = "sedentario";
                document.getElementById('objetivo').value = "mantener";
                //document.getElementById('resultado').innerText = "Calcular";
                document.getElementById("caloriasRequeridas").textContent = "Calcular";

                // Lógica para limpiar el formulario
                console.log('Formulario limpiado.');
                // Ocultar los botones cuando se selecciona el primer radio button
                //document.getElementById('button-container').style.display = 'none';
                document.getElementById('saveBtn').style.visibility = 'hidden';
                document.getElementById('copyBtn').style.visibility = 'hidden';

                document.getElementById('acList').style.display = 'none';
                document.getElementById('acAlgorithmList').style.display = 'none';

                // Limpiar tabla
                let daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                let table = document.getElementById("planificacion").getElementsByTagName("tbody")[0];
                let meals = ["breakfast", "brunch", "lunch", "snack", "dinner"];

                for (var i = 0; i < meals.length; i++) {
                    var meal = meals[i];
                    var row = table.rows[i];
                    var cells = row.cells;
                    //cells[0].textContent = meal.charAt(0).toUpperCase() + meal.slice(1); // Capitalize the meal name
                    for (var j = 0; j < daysOfWeek.length; j++) {
                        var day = daysOfWeek[j];
                        cells[j + 1].textContent = "";
                    }
                }

                document.getElementById('calculoRequerimiento').submit();//submit
            }

            function fillTable(menu) {
                let daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                let table = document.getElementById("planificacion").getElementsByTagName("tbody")[0];
                let meals = ["breakfast", "brunch", "lunch", "snack", "dinner"];

                for (var i = 0; i < meals.length; i++) {
                    var meal = meals[i];
                    //var row = table.rows[i];
                    var row = table.rows[i];//+1 // Start from the second row (index 1) to skip the header row

                    var cells = row.cells;
                    //cells[0].textContent = meal.charAt(0).toUpperCase() + meal.slice(1); // Capitalize the meal name
                    for (var j = 0; j < daysOfWeek.length; j++) {
                        var day = daysOfWeek[j];
                        //cells[j + 1].textContent = menu[day][meal];
                        //
                        

                        let cell = cells[j + 1];// // Start from the second cell (index 1) to skip the meal name cell
                        let recipeName = menu[day][meal];

                        cell.textContent = recipeName;

                        
                        //alert(`${day}  ${meal} ${recipeName}`)
                        if (recipeName) {
                            let recipe = recipes.find(recipe => recipe.name === recipeName);
                            if (recipe) {
                                // Mostrar el nombre de la receta en la celda
                                cell.innerHTML = `<strong>${recipe.name}</strong><br><br>`;

                                // Crear una lista no ordenada para los ingredientes
                                const ingredientsList = document.createElement('ul');
                                ingredientsList.style.fontSize = '50%'; // Establecer el tamaño de fuente al 50% del tamaño del nombre de la receta
                                ingredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separación vertical más pequeña

                                // Agregar cada ingrediente a la lista original
                                recipe.ingredients.forEach(ingredient => {
                                    const listItem = document.createElement('li');
                                    listItem.style.marginBottom = '0px'; 
                                    listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                                    ingredientsList.appendChild(listItem);
                                });

                                // Agregar la lista original de ingredientes debajo del nombre de la receta
                                cell.appendChild(ingredientsList);

                                // Agregar un salto de línea entre las dos listas
                                cell.appendChild(document.createElement('br'));

                                // Crear una segunda lista de ingredientes
                                const secondIngredientsList = document.createElement('ul');
                                secondIngredientsList.style.fontSize = '50%'; // Establecer el tamaño de fuente al 50% del tamaño del nombre de la receta
                                secondIngredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separación vertical más pequeña

                                // Agregar cada ingrediente a la segunda lista
                                recipe.ingredients.forEach(ingredient => {
                                    const listItem = document.createElement('li');
                                    listItem.style.marginBottom = '0px'; 
                                    listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                                    secondIngredientsList.appendChild(listItem);
                                });

                                // Agregar la segunda lista de ingredientes debajo de la lista original
                                cell.appendChild(secondIngredientsList);

                                // Al hacer clic en una receta, mostrarla en la celda correspondiente
                                cell.id = recipe.name;
                            }
                        }
                        /**/

                    }
                }
            }
        </script>

        <script>
            var user;
            function calcularCalorias() {

                var edad = parseInt(document.getElementById('edad').value);
                var sexo = document.getElementById('sexo').value;
                var peso = parseInt(document.getElementById('peso').value);
                var altura = parseInt(document.getElementById('altura').value);
                var ejercicio = document.getElementById('ejercicio').value;
                var objetivo = document.getElementById('objetivo').value;

                var tmb;
                if (sexo === 'hombre') {
                    tmb = (10 * peso) + (6.25 * altura) - (5 * edad) + 5;
                } else {
                    tmb = (10 * peso) + (6.25 * altura) - (5 * edad) - 161;
                }

                var factorEjercicio;
                switch (ejercicio) {
                    case 'sedentario':
                        factorEjercicio = 1.2;
                        break;
                    case 'ligero':
                        factorEjercicio = 1.375;
                        break;
                    case 'moderado':
                        factorEjercicio = 1.55;
                        break;
                    case 'fuerte':
                        factorEjercicio = 1.725;
                        break;
                    case 'profesional':
                        factorEjercicio = 1.9;
                        break;
                }

                var totalCalorias = tmb * factorEjercicio;

                if (objetivo === 'bajar') {
                    totalCalorias *= 0.85;
                } else if (objetivo === 'aumentar') {
                    totalCalorias *= 1.15;
                }

                //console.log(totalCalorias.toFixed(2))
                //alert(totalCalorias.toFixed(2))
                //document.getElementById('resultado').innerText = 'Calorías diarias necesarias: ' + totalCalorias.toFixed(2);
                document.getElementById("caloriasRequeridas").textContent = `${totalCalorias.toFixed(2)} Kcal`;
                
                // Example instantiation:
                user = new User(edad, sexo, peso, altura, ejercicio, objetivo, totalCalorias.toFixed(2));

                //document.getElementById("planificacion").enable = false;
                document.getElementById('planificacion').classList.remove('disabled');

                updateTotals();
            }
        </script>
        <script>
            // Función para mostrar la ventana modal con la lista de recetas
            function showRecipeModal(cell) {
                // Obtener el valor de la celda
                //var cellValue = cell.textContent.trim();
            
                // Actualizar el contenido de la ventana modal con el valor de la celda
                // var modalContent = modal.querySelector('.modal-content');
                // modalContent.innerHTML = '<span class="close" onclick="closeModal()">&times;</span><p>Contenido de la celda: ' + cellValue + '</p>';

                const modal = document.getElementById('modal');
                const recipeList = document.getElementById('recipe-list');

                // Limpiar la lista de recetas
                recipeList.innerHTML = '';

                // Agregar cada receta a la lista
                recipes.forEach(recipe => {
                    const listItem = document.createElement('li');
                    listItem.textContent = recipe.name;
                    listItem.addEventListener('click', function() {
                        
                        // // Mostrar el nombre de la receta en la celda
                        // cell.innerHTML = `<strong>${recipe.name}</strong><br><br>`;

                        // // Mostrar los ingredientes debajo del nombre de la receta
                        // // recipe.ingredients.forEach(ingredient => {
                        // //     cell.innerHTML += `${ingredient.portion} ${ingredient.unit} de ${ingredient.name}<br>`;
                        // // });
                        
                        // // Crear una lista no ordenada para los ingredientes
                        // const ingredientsList = document.createElement('ul');
                        // ingredientsList.style.fontSize = '50%'; // Establecer el tamaño de fuente al 50% del tamaño del nombre de la receta

                        // // Agregar cada ingrediente a la lista
                        // recipe.ingredients.forEach(ingredient => {
                        //     const listItem = document.createElement('li');
                        //     listItem.textContent = `${ingredient.portion} ${ingredient.unit} de ${ingredient.name}`;
                        //     ingredientsList.appendChild(listItem);
                        // });

                        // // Agregar la lista de ingredientes debajo del nombre de la receta
                        // cell.appendChild(ingredientsList);
                        // Mostrar el nombre de la receta en la celda
                        cell.innerHTML = `<strong>${recipe.name}</strong><br><br>`;

                        // Crear una lista no ordenada para los ingredientes
                        const ingredientsList = document.createElement('ul');
                        ingredientsList.style.fontSize = '50%'; // Establecer el tamaño de fuente al 50% del tamaño del nombre de la receta
                        ingredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separación vertical más pequeña

                        // Agregar cada ingrediente a la lista original
                        recipe.ingredients.forEach(ingredient => {
                            const listItem = document.createElement('li');
                            listItem.style.marginBottom = '0px'; 
                            listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                            ingredientsList.appendChild(listItem);
                        });

                        // Agregar la lista original de ingredientes debajo del nombre de la receta
                        cell.appendChild(ingredientsList);

                        // Agregar un salto de línea entre las dos listas
                        cell.appendChild(document.createElement('br'));

                        // Crear una segunda lista de ingredientes
                        const secondIngredientsList = document.createElement('ul');
                        secondIngredientsList.style.fontSize = '50%'; // Establecer el tamaño de fuente al 50% del tamaño del nombre de la receta
                        secondIngredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separación vertical más pequeña

                        // Agregar cada ingrediente a la segunda lista
                        recipe.ingredients.forEach(ingredient => {
                            const listItem = document.createElement('li');
                            listItem.style.marginBottom = '0px'; 
                            listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                            secondIngredientsList.appendChild(listItem);
                        });

                        // Agregar la segunda lista de ingredientes debajo de la lista original
                        cell.appendChild(secondIngredientsList);


                        // Al hacer clic en una receta, mostrarla en la celda correspondiente
                        cell.id = recipe.name;

                        document.getElementById('saveBtn').disabled = false;
                        //document.getElementById('copyBtn').disabled = false;
                        document.getElementById('saveBtn').style.background = '#FF9CCA';
                        //document.getElementById('copyBtn').style.background = '#FF9CCA';

                        //cell.textContent = recipe.name;
                        closeModal();
                        generateInstructionsAndIngredients();//!!!!!!
                        updateTotals();
                    });
                    recipeList.appendChild(listItem);
                });

                // Mostrar la ventana modal
                modal.style.display = 'block';
            }
            
            // Función para cerrar la ventana modal
            function closeModal() {
                var modal = document.getElementById("modal");
                modal.style.display = "none";
            }
            
            // Cerrar la ventana modal al hacer clic fuera de ella
            window.onclick = function(event) {
                var modal = document.getElementById("myModal");
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        </script>
        <script>

            function generateInstructionsAndIngredients() {
                let allInstructions = []; // Lista de instrucciones única
                let allIngredients = {}; // Objeto para almacenar ingredientes

                // Recorrer la tabla de planificación
                let table = document.getElementById("planificacion").getElementsByTagName("tbody")[0];
                let rows = table.getElementsByTagName("tr");
                for (let i = 0; i < rows.length - 1; i++) { // Ignorar la última fila (Total)
                    let cells = rows[i].getElementsByTagName("td");
                    for (let j = 1; j < cells.length; j++) {
                        //let recipeName = cells[j].textContent.trim();
                        //let recipeName = cells[j].querySelector('strong').textContent.trim();
                        let recipeName = cells[j].id
                        //(recipeName)
                        if (recipeName !== "") { // Verificar si hay una receta
                            // Buscar la receta en la lista de recetas
                            let recipe = recipes.find(recipe => recipe.name === recipeName);
                            if (recipe) {
                                // Agregar instrucciones de la receta a la lista de instrucciones únicas
                                if (recipe.preparation && !allInstructions.includes(`${recipe.name}: ${recipe.preparation}`)) {
                                    allInstructions.push(`${recipe.name}: ${recipe.preparation}`);
                                }
                                // Sumar los ingredientes de la receta
                                recipe.ingredients.forEach(ingredient => {
                                    let key = ingredient.name.toLowerCase(); // Convertir el nombre del ingrediente a minúsculas
                                    if (key in allIngredients) {
                                        allIngredients[key].portion += ingredient.portion;
                                    } else {
                                        allIngredients[key] = { portion: ingredient.portion, unit: ingredient.unit };
                                    }
                                });
                            }
                        }
                    }
                }

                //console.log(user.allIngredients)
                user.allIngredients = allIngredients;
                //alert(user.allIngredients)

                // Mostrar las instrucciones en la lista de instrucciones
                let listaInstrucciones = document.getElementById("listaInstrucciones");
                listaInstrucciones.innerHTML = "";
                //listaInstrucciones.innerHTML = "<h2>Lista de Instrucciones</h2>";
                allInstructions.forEach(instruction => {
                    let li = document.createElement("li");
                    //li.textContent = instruction;
                    // Dividir el string en dos partes usando el símbolo dos puntos como separador
                    const parts = instruction.split(':');

                    // Verificar si se encontró el símbolo dos puntos y si se dividió en dos partes
                    if (parts.length === 2) {
                        // Crear un elemento de texto para la primera parte (en negritas)
                        const text1 = document.createElement('strong');
                        text1.textContent = parts[0].trim() + ':';

                        // Crear un elemento de texto para la segunda parte
                        const text2 = document.createTextNode(parts[1].trim());

                        // Crear un elemento span para envolver los dos textos
                        const span = document.createElement('span');

                        // Agregar los textos al span
                        span.appendChild(text1);
                        span.appendChild(document.createTextNode(' ')); // Agregar un espacio entre los textos
                        span.appendChild(text2);

                        // Agregar el span al elemento de lista
                        li.appendChild(span);
                    } else {
                        // Si no se encontró el símbolo dos puntos, agregar el texto como está
                        li.textContent = instruction;
                    }
                    //
                    listaInstrucciones.appendChild(li);
                });

                // Mostrar los ingredientes en la lista de compras
                let listaCompras = document.getElementById("listaCompras");
                listaCompras.innerHTML = "";

                //listaCompras.innerHTML = "<h2>Lista de Compras</h2>";
                for (let ingredient in allIngredients) {
                    let li = document.createElement("li");
                    li.textContent = `${allIngredients[ingredient].portion.toFixed(2)} ${allIngredients[ingredient].unit} de ${ingredient}`;
                    listaCompras.appendChild(li);
                }
            }

        </script>
        <!-- Script externo -->
        <script src="js/models/recipe.js"></script>
        <script src="js/models/food.js"></script>
        <script src="js/models/group.js"></script>
        <script src="js/models/user.js"></script>

        <script src="js/data/groups.js"></script>

        <script src="js/data/recipes/breakfasts.js"></script>
        <script src="js/data/recipes/lunches.js"></script>
        <script src="js/data/recipes/dinners.js"></script>
        <script src="js/data/recipes/snacks.js"></script>
        <script src="js/data/recipes.js"></script>

        <script src="js/data/foods/cerealsAndTubersWithFat.js"></script>
        <script src="js/data/foods/energyFreeFoods.js"></script>
        <script src="js/data/foods/fatFreeCerealsAndTubers.js"></script>
        <script src="js/data/foods/foodsOfAnimalOriginVeryLowInFat.js"></script>
        <script src="js/data/foods/freeConsumptionVegetables.js"></script>
        <script src="js/data/foods/fruitsRichInFiberAndLowInSugar.js"></script>
        <script src="js/data/foods/highEnergyPreparedFoods.js"></script>
        <script src="js/data/foods/highFatAnimalFoods.js"></script>
        <script src="js/data/foods/highSodiumEnergyFreeFoods.js"></script>
        <script src="js/data/foods/legumes.js"></script>
        <script src="js/data/foods/foodsOfAnimalOriginLowInFat.js"></script>
        <script src="js/data/foods/moderateFatAnimalFoods.js"></script>
        <script src="js/data/foods/moderateHighCalciumSkimMilk.js"></script>
        <script src="js/data/foods/moderateHighCalciumWholeMilk.js"></script>
        <script src="js/data/foods/monounsaturatedFatsWithProtein.js"></script>
        <script src="js/data/foods/saturatedAndTransFats.js"></script>
        <script src="js/data/foods/polyunsaturatedFats.js"></script>
        <script src="js/data/foods/sugars.js"></script>
        <script src="js/data/foods/sugarsWithFat.js"></script>
        <script src="js/data/foods/vegetables.js"></script>
        <script src="js/data/foods.js"></script>
    </body>
</html>