<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>NutriCompa</title>
        <link rel="icon" type="image/png" href="nutriCompa.png">

        <!--<style>
            body {
                font-family: Arial, sans-serif;
            }

            form {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
            }

            form div {
                display: flex;
                align-items: center;
            }

            form label {
                margin-right: 5px;
            }

            form input,
            form select {
                margin-right: 10px;
            }

            #resultado {
                text-align: center;
                margin-top: 20px;
            }
        </style> --> 
        <style>
            .table-container {
                overflow-x: auto; /* Permite el desplazamiento horizontal */
                max-width: 100%; /* Establece el ancho m√°ximo */
            }

            .invisible-button {
                visibility: hidden;
            }

            .shopping-lists {
                display: flex;
            }

            .shopping-list {
                flex: 1;
                margin-right: 20px; /* Espacio entre las listas */
            }

            /* Estilo adicional para las listas de compras */
            .shopping-list ul {
                list-style-type: none;
                padding: 0;
            }

            /* CSS to disable the table */
            /* #planificacion.disabled {
                pointer-events: none;  Disable pointer events 
                opacity: 0.5; Optionally adjust opacity to visually indicate disabled state 
            } */
            .disabled {
                pointer-events: none;
                opacity: 0.6; /* Optional: This will visually indicate that the table is disabled */
            }

            #calculoRequerimiento {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                max-width: 600px;
                margin: 0 auto;
                padding: 20px;
                border: 1px solid #ccc;
                border-radius: 5px;
            }
        
            #calculoRequerimiento div {
                /* flex: 0 0 48%; */
                flex: 0 0 calc(33.333% - 10px); /* Cambiado el ancho para que ocupe un tercio del espacio disponible */
                /* margin-bottom: 10px; */
            }
        
            #calculoRequerimiento label {
                display: block;
                font-weight: bold;
                margin-bottom: 5px;
            }
        
            #calculoRequerimiento input,
            #calculoRequerimiento select {
                width: calc(100% - 10px);
                padding: 5px;
                border: 1px solid #ccc;
                border-radius: 3px;
            }
        
            #calculoRequerimiento button {
                width: 100%;
                padding: 10px;
                background-color: #FF76BF;
                color: white;
                border: none;
                border-radius: 3px;
                cursor: pointer;
            }
        
            #resultado {
                margin-top: 20px;
                text-align: center;
                font-weight: bold;
            }
        </style> 
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: #f8f8f8;
            }

            h1,
            h2 {
                color: #333;
                text-align: center;
                margin-bottom: 20px;
            }

            /* form {
                margin-bottom: 20px;
                text-align: center;
            } */

            label {
                display: block;
                margin-bottom: 5px;
            }

            input[type="number"] {
                width: 100px;
                padding: 8px;
                margin-bottom: 10px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

            .form-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .form-row label {
                flex: 1;
                margin-right: 10px;
            }

            .form-row input[type="number"] {
                flex: 2;
            }

            button {
                padding: 10px 20px;
                background-color: #FF9CCA;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }

            th,
            td {
                padding: 10px;
                text-align: center;
                border-bottom: 1px solid #ddd;
            }

            th {
                background-color: #FF9CCA;
                color: white;
            }

            tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            td[contenteditable="true"] {
                background-color: #fff;
                cursor: pointer;
            }

            ul {
                list-style-type: none;
                padding: 0;
                margin: 0;
            }

            li {
                margin-bottom: 10px;
            }
        </style>
        <style>
            /* Estilos para la ventana modal */
            /* .modal {
                display: none;
                position: fixed;
                z-index: 1;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0, 0, 0, 0.4);
            }

            .modal-content {
                background-color: #fefefe;
                margin: 15% auto;
                padding: 20px;
                border: 1px solid #888;
                width: 80%;
            } */
            /* Estilo para la ventana modal */
            .modal {
                display: none; /* Ocultar la modal por defecto */
                position: fixed; /* Posici√≥n fija para mantenerla en el centro */
                z-index: 1; /* Posici√≥n en capas para que est√© por encima del resto del contenido */
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto; /* Habilitar el desplazamiento si el contenido es demasiado grande */
                background-color: rgba(0, 0, 0, 0.4); /* Fondo oscuro semitransparente */
            }

            /* Estilo para el contenido de la modal */
            .modal-content {
                background-color: #fefefe; /* Fondo blanco */
                margin: 25% auto; /* Margen superior e inferior para centrarlo verticalmente */
                padding: 20px 20px 50px 20px;

                border: 1px solid #888;
                width: 80%; /* Ancho de la modal */
                max-width: 600px; /* Ancho m√°ximo */
            
                position: relative;/**/
                /* height: calc(100vh - 40px); Resta 40px del alto de la ventana para un espacio arriba y abajo */
                /* height: 100vh; El alto es igual al alto de la parte visible de la ventana */
                /* height: 50%;  */
                height: calc(50vh - 40px); /* La mitad del alto de la ventana menos un espacio de 40px arriba y abajo */
                overflow-y: hidden; /* Oculta el desplazamiento vertical en el contenedor principal */

                /* overflow-y: auto; Agrega desplazamiento vertical si el contenido excede el espacio disponible */
            }

            /* Estilo para el bot√≥n de cerrar */
            .close {
                color: #aaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
                /*  */
                position: absolute;
                top: 0;
                left: 0;
                padding: 5px 5px 5px 10px;/* 10 */
                cursor: pointer;
            }

            .close:hover,
            .close:focus {
                color: black;
                text-decoration: none;
                cursor: pointer;
            }

            /* Estilo para el bot√≥n Limpiar */
            .clear-button {
                background-color: #f44336;
                color: white;
                border: none;
                padding: 8px 12px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 14px;
                margin-left: 10px;
                cursor: pointer;
            }

            .clear-button:hover {
                background-color: #ff6659;
            }

            /* Estilo para las opciones */
            .modal-options {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 15px;
            }

            /* Estilo para el input y select */
            #recipe-search,
            #recipe-category {
                flex: 1;
                margin-right: 10px;
                padding: 8px;
                font-size: 14px;
            }

            /* Estilo para la lista de recetas */
            #recipe-list {
                list-style-type: none;
                padding: 0;
                height: calc(100% - 40px); /* El alto de la lista ser√° el 100% menos un espacio de 40px arriba y abajo */
                overflow-y: auto; /* Agrega desplazamiento vertical solo si el contenido de la lista excede el espacio disponible */
            }

            /* Estilo para los elementos de la lista de recetas */
            #recipe-list li {
                margin-bottom: 10px;
                cursor: pointer;
            }

            #recipe-list li:hover {
                background-color: #f0f0f0;
            }
        </style>
            <style>
                /* Estilos para el contenedor de los radio buttons */
                #radio-container {
                    text-align: center;
                    margin-top: 5px;
                    margin-bottom: 10px;

                }
        
                /* Estilos para los radio buttons */
                #radio-container input[type="radio"] {
                    display: none;
                }


        
                #radio-container label {
                    display: inline-block;
                    width: 15px;
                    height: 15px;
                    border-radius: 50%;
                    background-color: #ccc;
                    margin: 0 10px;
                    cursor: pointer;
                }
        
                /* Estilos para cuando un radio button est√° seleccionado */
                /* #radio-container input[type="radio"]:checked + label {
                    background-color: #FF9CCA;
                } */
/* 
                /* Estilos para el radio azul cuando est√° seleccionado */
                #radio-container input.blue:checked + label {
                    background-color: #09D6DB;
                }

                /* Estilos para el radio verde cuando est√° seleccionado */
                #radio-container input.green:checked + label {
                    background-color: #48BF3B;
                }

                /* Estilos para el radio rojo cuando est√° seleccionado */
                #radio-container input.red:checked + label {
                    background-color: #FF3B3B;
                }

                .button-container {
                    margin-top: 20px;
                }
                /* Estilos para los botones adicionales */
                /* #button-container {
                    text-align: center;
                    margin-top: 20px;
 
                    display: flex; 
                }

                #button-container button {
                    padding: 10px 20px; 
                    margin: 0 10px;
                    cursor: pointer;
                } */
                /* #button-container {
                    display: flex;
                    justify-content: space-between; Distribuye los botones equitativamente en el contenedor 
                    margin-top: 20px; A√±ade un margen superior para separar los botones del resto del formulario 
                }

                #button-container button {
                    flex: 1; Los botones ocupar√°n todo el espacio disponible horizontalmente 
                    padding: 10px; A√±ade relleno para hacer los botones m√°s grandes 
                    border: none; Quita el borde de los botones 
                    background-color: #FF9CCA; Color de fondo 
                    color: white; Color del texto 
                    cursor: pointer; Cambia el cursor al pasar sobre los botones 
                    border-radius: 5px; A√±ade bordes redondeados 
                    transition: background-color 0.3s; Agrega una transici√≥n suave para el cambio de color de fondo
                }

                #button-container button:hover {
                    background-color: #45a049; Cambia el color de fondo al pasar el mouse sobre los botones
                } */

                #spinner {
                    position: fixed; /* Posici√≥n fija para mantenerlo en la misma ubicaci√≥n */
                    top: 50%; /* Alinea la parte superior del spinner al 50% del viewport */
                    left: 50%; /* Alinea la parte izquierda del spinner al 50% del viewport */
                    transform: translate(-50%, -50%); /* Mueve el spinner hacia arriba y hacia la izquierda en relaci√≥n con su tama√±o */
                    z-index: 1000; /* Asegura que el spinner est√© por encima de otros elementos */
                    background-color: rgba(255, 255, 255, 0.8); /* Fondo semitransparente blanco */
                    padding: 20px; /* Espacio interno del spinner */
                    border-radius: 10px; /* Borde redondeado */
                    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); /* Sombra */
                    display: none; /* Oculta el spinner por defecto */
                }

                #spinner {
                    text-align: center;
                }

                .dot {
                    display: inline-block;
                    width: 10px;
                    height: 10px;
                    background-color: lightgray; /* Color azul */
                    border-radius: 50%; /* Forma de c√≠rculo */
                    margin: 0 5px; /* Espacio entre los puntos */
                    animation: fadeInOut 0.7s infinite; /* Animaci√≥n de 1 segundo que se repite infinitamente */
                }

                @keyframes fadeInOut {
                    0%{
                        opacity: 0; /* Comienza y termina invisible */
                    }
                    33% {
                        opacity: 0.33; /* Se hace visible a la mitad de la animaci√≥n */
                        background-color: #09D6DB;
                    }
                    66% {
                        opacity: 0.66; /* Se hace visible a la mitad de la animaci√≥n */
                        background-color: #48BF3B;
                    }
                    100% {
                        opacity: 1; /* Se hace visible a la mitad de la animaci√≥n */
                        background-color: #FF3B3B;
                    }
                }




            </style>
    </head>

    <body>
        <!-- <div id="spinner" style="display: none;">‚åõ Cargando <span id="dots"></span></div> -->
        <div id="spinner" style="display: none;">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>

        <div id="radio-container">
            <input class="blue" checked type="radio" id="radio1" name="radios" onclick="clearAll()">
            <label for="radio1"></label>
        
            <input class="green" type="radio" id="radio2" name="radios" onclick="handleRadioChange('c')">
            <label for="radio2"></label>
        
            <input class="red" type="radio" id="radio3" name="radios" onclick="handleRadioChange('a')">
            <label for="radio3"></label>
        </div>

        <!-- <h1>Calculadora de Requerimiento Cal√≥rico</h1> -->
        <form id="calculoRequerimiento" onsubmit="calcularCalorias(); return false;">
            <div>
                <label for="edad">Edad:</label>
                <input value="30" type="number" id="edad" name="edad" required>
            </div>
            <div>
                <label for="altura">Altura (cm):</label>
                <input value="150" type="number" id="altura" name="altura" required>
            </div>

            <div>
                <label for="peso">Peso (kg):</label>
                <input value="50" type="number" id="peso" name="peso" required>
            </div>

            <div>
                <label for="sexo">Sexo:</label>
                <select id="sexo" name="sexo" required>
                    <option value="mujer">Mujer</option>
                    <option value="hombre">Hombre</option>
                </select>
            </div>

            <div>
                <label for="ejercicio">Nivel de ejercicio:</label>
                <select id="ejercicio" name="ejercicio" required>
                    <option value="sedentario">Poco o ning√∫n ejercicio</option>
                    <option value="ligero">Ejercicio ligero (1-3 d√≠as por semana)</option>
                    <option value="moderado">Ejercicio Moderado (3-5 d√≠as por semana)</option>
                    <option value="fuerte">Ejercicio Fuerte (6 d√≠as por semana)</option>
                    <option value="profesional">Ejercicio profesional o extremo</option>
                </select>
            </div>
            <div>
                <label for="objetivo">Objetivo:</label>
                <select id="objetivo" name="objetivo" required>
                    <option value="mantener">Mantener peso (45% C, 30% P, 25% G)</option>
                    <option value="bajar">Bajar de peso  (40% C, 35% P, 25% G)</option>
                    <option value="aumentar">Aumentar masa muscular  (55% C, 20% P, 25% G)</option>
                </select>
            </div>
            <div class="button-container">
                <button id="saveBtn" class="invisible-button" onclick="save()">Guardar</button>
            </div>
            <div class="button-container">
                <button id="caloriasRequeridas" type="submit">Calcular</button>
            </div>
            <div class="button-container">
                <button id="copyBtn" class="invisible-button" onclick="copy()">Copiar</button>
            </div>
        </form>
        <div id="resultado"></div> 

        <div class="table-container">
        <!-- <h2>Planificaci√≥n Semanal de Comidas</h2> -->
        <table class="disabled" id="planificacion">
            <thead>
                <tr>
                    <th></th>
                    <th>L</th>
                    <th>M</th>
                    <th>M</th>
                    <th>J</th>
                    <th>V</th>
                    <th>S</th>
                    <th>D</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ü•û</td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Desayuno')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Desayuno')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Desayuno')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Desayuno')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Desayuno')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Desayuno')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Desayuno')"></td>
                </tr>
                <tr>
                    <td>ü•õ</td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                </tr>
                <tr>
                    <td>üçú</td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Comida')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Comida')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Comida')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Comida')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Comida')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Comida')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Comida')"></td>
                </tr>
                <tr>
                    <td>üç¶</td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Colaci√≥n')"></td>
                </tr>
                <tr>
                    <td>üç£</td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Cena')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Cena')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Cena')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Cena')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Cena')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Cena')"></td>
                    <td contenteditable="true" onclick="showRecipeModal(this, 'Cena')"></td>
                </tr>
                <tr>
                    <td>=</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>üßÆ</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        </div>

        <!-- Ventana Modal -->
        <!-- <div id="modal" class="modal">
            <div class="modal-content">

                <span class="close" onclick="closeModal()">&times;</span>

                <button onclick="clearTableCell(cell)">Limpiar</button>
                <input type="text" id="recipe-search" placeholder="Buscar receta...">
                <select id="recipe-category">
                    <option value="All">Todas las recetas</option>
                    <option value="Breakfast">Desayuno</option>
                    <option value="Lunch">Almuerzo</option>
                    <option value="Dinner">Cena</option>
                    <option value="Snack">Colaci√≥n</option>
                </select>
                <p>Contenido de la ventana modal.</p>
                <h2>Selecciona una receta:</h2>
                <ul id="recipe-list"></ul>
            </div>
        </div> -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <br>
                <div class="modal-options">
                    <input type="text" id="recipe-search" placeholder="Buscar ...">
                    <select id="recipe-category">
                        <option value="All">Todas las recetas</option>
                        <option value="Desayuno">Desayuno</option>
                        <option value="Comida">Comida</option>
                        <option value="Cena">Cena</option>
                        <option value="Colaci√≥n">Colaci√≥n</option>
                    </select>
                    <button class="clear-button" onclick="clearTableCell()">Limpiar</button>
                </div>
                <ul id="recipe-list"></ul>
            </div>
        </div>
        

        <h2>Preparaci√≥n</h2>
        <ul id="listaInstrucciones">
        </ul>

        <h2>Lista de compras</h2>
        <!-- <ul id="listaCompras">
        </ul> -->
        <div class="shopping-lists">
            <div class="shopping-list">
                <h2>=</h2>
                <ul id="listaCompras">
                    <!-- Elementos de la lista de compras 1 -->
                </ul>
            </div>
            <div class="shopping-list">
                <h2>üßÆ</h2>
                <ul id="listaCompras2">
                    <!-- Elementos de la lista de compras 2 -->
                </ul>
            </div>
            <div id="acList" style="display: none;" class="shopping-list">
                <h2>= ac</h2>
                <ul id="listaCompras3">
                    <!-- Elementos de la lista de compras 3 -->
                </ul>
            </div>
            <div id="acAlgorithmList" style="display: none;" class="shopping-list">
                <h2>üßÆ ac</h2>
                <ul id="listaCompras4">
                    <!-- Elementos de la lista de compras 4 -->
                </ul>
            </div>
        </div>
        

        <script>
            // Funci√≥n para mostrar el spinner
            function showSpinner() {
                const spinner = document.getElementById('spinner');
                spinner.style.display = 'inline-block';
            }

            // Funci√≥n para ocultar el spinner
            function hideSpinner() {
                const spinner = document.getElementById('spinner');
                spinner.style.display = 'none';
            }

            // Variable para almacenar si alg√∫n campo ha cambiado
            //let camposCambiados = false;

            // Obtener todos los campos del formulario
            const camposFormulario = document.querySelectorAll("#calculoRequerimiento input, #calculoRequerimiento select");

            // Agregar un controlador de eventos change a cada campo
            camposFormulario.forEach(campo => {
                campo.addEventListener("change", () => {
                    //camposCambiados = true;
                    document.getElementById('caloriasRequeridas').click();//submit
                    //cleanResult()
                    document.getElementById('saveBtn').disabled = false;
                    document.getElementById('copyBtn').disabled = true;
                    document.getElementById('saveBtn').style.background = '#FF9CCA';
                    document.getElementById('copyBtn').style.background = 'lightgray';

                    generateInstructionsAndIngredients();//!!!!!!
                });
            });

            function cleanResult(){
                document.getElementById("caloriasRequeridas").textContent = "Calcular";
            }

            function updateTotals() {
                // Obtener la tabla y las filas de la tabla
                let table = document.getElementById("planificacion").getElementsByTagName("tbody")[0];
                let rows = table.getElementsByTagName("tr");

                // Array para los d√≠as de la semana
                let daysOfWeek = ["lunes", "martes", "mi√©rcoles", "jueves", "viernes", "s√°bado", "domingo"];

                // Iterar sobre cada columna (d√≠a)
                for (let i = 1; i < rows[0].cells.length; i++) { // Empezamos desde 1 para omitir la primera celda (nombre de la comida)
                    // Variables para almacenar los totales de calor√≠as, carbohidratos, prote√≠nas y grasas
                    let totalCalories = 0;
                    let totalCarbohydrates = 0;
                    let totalProteins = 0;
                    let totalFats = 0;

                    // Iterar sobre cada fila (comida)
                    for (let j = 0; j < rows.length - 1; j++) {
                        // Obtener el nombre de la receta del ID de la celda
                        let recipeName = rows[j].cells[i].id;

                        // Verificar si la celda contiene una receta
                        if (recipeName !== "") {
                            //alert(recipeName)

                            // Buscar la receta en la lista de recetas
                            let recipe = recipes.find(recipe => recipe.name === recipeName);

                            // Si se encuentra la receta
                            if (recipe) {
                                //alert('recipe')
                                // Iterar sobre los ingredientes de la receta
                                recipe.ingredients.forEach(ingredient => {
                                    //alert(ingredient.name)
                                    // Buscar el alimento correspondiente al ingrediente
                                    let food = foods.find(food => food.name === ingredient.name);
                                    if (food) {
                                        //alert('food')
                                        // Buscar el grupo al que pertenece el alimento
                                        let group = groups.find(group => group.name === food.group);
                                        if (group) {
                                            //alert('group')
                                            // Calcular el total de calor√≠as, carbohidratos, prote√≠nas y grasas
                                            
                                            // let portion = parseFloat(ingredient.portion);
                                            // totalCalories += (portion * parseFloat(group.energy));
                                            // totalCarbohydrates += (portion * parseFloat(group.carbohydrates));
                                            // totalProteins += (portion * parseFloat(group.proteins));
                                            // totalFats += (portion * parseFloat(group.fat));

                                            // let portion = parseFloat(ingredient.portion);

                                            // // Calcular el factor de ajuste para las calor√≠as y los macronutrientes
                                            // let adjustFactor = portion / parseFloat(food.portion);

                                            // // Ajustar las calor√≠as y los macronutrientes seg√∫n el factor de ajuste
                                            // totalCalories += (adjustFactor * parseFloat(group.energy));
                                            // totalCarbohydrates += (adjustFactor * parseFloat(group.carbohydrates));
                                            // totalProteins += (adjustFactor * parseFloat(group.proteins));
                                            // totalFats += (adjustFactor * parseFloat(group.fat));

                                            // Calcular el factor de ajuste
                                            
                                            let adjustFactor = parseFloat(ingredient.portion) / parseFloat(food.portion);
                                            //alert(`${ingredient.name} ${parseFloat(ingredient.portion)} ${parseFloat(food.portion)} ${adjustFactor}`)
                                            // Calcular las calor√≠as ajustadas seg√∫n el factor de ajuste
                                            let adjustedCalories = parseFloat(group.energy) * adjustFactor;
                                            // Calcular los carbohidratos ajustados seg√∫n el factor de ajuste
                                            let adjustedCarbohydrates = parseFloat(group.carbohydrates) * adjustFactor;
                                            // Calcular las prote√≠nas ajustadas seg√∫n el factor de ajuste
                                            let adjustedProteins = parseFloat(group.proteins) * adjustFactor;
                                            // Calcular las grasas ajustadas seg√∫n el factor de ajuste
                                            let adjustedFats = parseFloat(group.fat) * adjustFactor;
                                            // Sumar las calor√≠as ajustadas a totalCalories
                                            totalCalories += adjustedCalories;
                                            // Sumar los carbohidratos ajustados a totalCarbohydrates
                                            totalCarbohydrates += adjustedCarbohydrates;
                                            // Sumar las prote√≠nas ajustadas a totalProteins
                                            totalProteins += adjustedProteins;
                                            // Sumar las grasas ajustadas a totalFats
                                            totalFats += adjustedFats;
                                        }
                                    }
                                });
                            }
                        }
                    }

                    // Actualizar la celda de Total para el d√≠a correspondiente con los totales calculados
                    let totalCell = rows[rows.length - 2].cells[i];
                    //totalCell.textContent = `Calor√≠as: ${totalCalories.toFixed(2)}, Carbohidratos: ${totalCarbohydrates.toFixed(2)}g, Prote√≠nas: ${totalProteins.toFixed(2)}g, Grasas: ${totalFats.toFixed(2)}g`;
                    // Calcular el valor de los macronutrientes en kilocalor√≠as
                    let macros = (totalCarbohydrates.toFixed(2) * 4) + (totalProteins.toFixed(2) * 4) + (totalFats.toFixed(2) * 9)
                    
                    // Obtener las calor√≠as requeridas del usuario
                    //alert(user.calories);
                    let userCalories = user.calories;

                    // Establecer el estilo de la celda dependiendo de los valores de calor√≠as requeridas, calor√≠as totales y macronutrientes
                    if (userCalories < totalCalories.toFixed(2) && userCalories < macros) {
                        totalCell.style.backgroundColor = '#FF3B3B'; //red // Si las calor√≠as requeridas son menores que las calor√≠as totales o los macronutrientes, establecer el fondo rojo
                    } else if (userCalories >= totalCalories.toFixed(2) && userCalories <= macros) {
                        totalCell.style.backgroundColor = '#48BF3B';  //green // Si las calor√≠as requeridas son mayores o iguales a las calor√≠as totales y los macronutrientes, establecer el fondo verde
                    } else {
                        totalCell.style.backgroundColor = '#09D6DB'; //blue // Si no se cumple ninguna de las condiciones anteriores, establecer el fondo azul
                    }
                    
                    totalCell.innerHTML = `
                        <span style="font-size: 80%; color: #333;">
                            Calor√≠as (avg): <strong>${totalCalories.toFixed(2)}</strong>,<br> 
                            Macronutrientes (Kcal): <strong>${macros.toFixed(2)}</strong>,<br> 
                            Carbohidratos (avg): <strong>${totalCarbohydrates.toFixed(2)}g</strong>,<br>
                            Prote√≠nas (avg): <strong>${totalProteins.toFixed(2)}g</strong>,<br> 
                            Grasas (avg): <strong>${totalFats.toFixed(2)}g</strong>
                        </span>
                    `;

                    // Actualizar la celda de Total para el d√≠a correspondiente con los totales calculados
                    let algorithmCell = rows[rows.length - 1].cells[i];
                    //totalCell.textContent = `Calor√≠as: ${totalCalories.toFixed(2)}, Carbohidratos: ${totalCarbohydrates.toFixed(2)}g, Prote√≠nas: ${totalProteins.toFixed(2)}g, Grasas: ${totalFats.toFixed(2)}g`;
                    let algorithmMacros = (totalCarbohydrates.toFixed(2) * 4) + (totalProteins.toFixed(2) * 4) + (totalFats.toFixed(2) * 9)
                    algorithmCell.innerHTML = `
                        <span style="font-size: 80%; color: #333;">
                            Calor√≠as: <strong>${totalCalories.toFixed(2)}</strong>,<br> 
                            Carbohidratos: <strong>${totalCarbohydrates.toFixed(2)}g</strong>,<br>
                            Prote√≠nas: <strong>${totalProteins.toFixed(2)}g</strong>,<br> 
                            Grasas: <strong>${totalFats.toFixed(2)}g</strong>
                        </span>                     
                    `;

                }
            }



        </script>

        <script>
            var currentUser;
            var allAditionalIngredients;
            var mergedShoppingLists;
            var mainUrl;
            var complementUrl;
            var complement;

            function sumShoppingLists(list1, list2) {
                // Crear un objeto para realizar un seguimiento de los elementos y sus porciones
                let dict = {};

                // Sumar las porciones de la primera lista al objeto
                for (const item in list1) {
                    if (list1.hasOwnProperty(item)) {
                        const key = item; // Utilizar el nombre del elemento como clave √∫nica
                        dict[key] = list1[item].portion; // Agregar la porci√≥n al objeto
                    }
                }

                // Sumar las porciones de la segunda lista al objeto
                for (const item in list2) {
                    if (list2.hasOwnProperty(item)) {
                        const key = item; // Utilizar el nombre del elemento como clave √∫nica
                        if (dict.hasOwnProperty(key)) {
                            // Si el elemento ya est√° en el objeto, sumar la porci√≥n
                            dict[key] += list2[item].portion;
                        } else {
                            // Si el elemento no est√° en el objeto, agregarlo con su porci√≥n
                            dict[key] = list2[item].portion;
                        }
                    }
                }

                // Convertir el objeto de nuevo a una lista de elementos
                const result = {};
                for (const key in dict) {
                    if (dict.hasOwnProperty(key)) {
                        result[key] = { portion: dict[key], unit: list1[key] ? list1[key].unit : list2[key].unit };
                    }
                }

                return result;
            }

            function mainCallBack(response){
                console.log('allAditionalIngredients')
                console.log(response.shopping)
                console.log(allAditionalIngredients)

                mergedShoppingLists = sumShoppingLists(response.shopping, allAditionalIngredients);
                console.log('mergedShoppingLists');
                console.log(mergedShoppingLists)

        
                fillForm(response.profile);
                fillTable(response.menu);

                document.getElementById('caloriasRequeridas').click();
                generateInstructionsAndIngredients();//!!!!!!

                hideSpinner();
            }

            function complementCallBack(response){
                complement = response;
                allAditionalIngredients = complement.shopping;

                console.log('allAditionalIngredients PRE')
                console.log(response.shopping)
                console.log(allAditionalIngredients)

                makeRequest(mainUrl, mainCallBack);
            }

            function handleRadioChange(usr) {

                showSpinner();

                cleanTable();

                mergedShoppingLists = null;
                currentUser = usr;

                let baseUrl = "https://jsonfileapi.onrender.com/";

                mainUrl = baseUrl+usr;
                //let url = "http://127.0.0.1:5000/"+usr;
                complementUrl = usr === 'a' ? baseUrl+'c' : baseUrl +'a';

                makeRequest(complementUrl, complementCallBack);
                // makeRequest(url, mainCallBack);

                // Mostrar los botones cuando se selecciona el segundo o tercer radio button
                document.getElementById('saveBtn').style.visibility = 'visible';
                document.getElementById('copyBtn').style.visibility = 'visible';
                document.getElementById('saveBtn').disabled = true;
                document.getElementById('copyBtn').disabled = true;
                document.getElementById('saveBtn').style.background = 'lightgray';
                document.getElementById('copyBtn').style.background = 'lightgray';

                document.getElementById('acList').style.display = 'block';
                document.getElementById('acAlgorithmList').style.display = 'block';

                
            }

            function save() {
                // L√≥gica para el bot√≥n "Guardar"
                console.log('Guardando...');

                showSpinner();

                // Recopilar informaci√≥n del formulario
                var formData = {
                    age: document.getElementById('edad').value,
                    exercise: document.getElementById('ejercicio').value,
                    height: document.getElementById('altura').value,
                    objective: document.getElementById('objetivo').value,
                    weight: document.getElementById('peso').value,
                    sex: document.getElementById('sexo').value
                };

                /*
                let daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                let meals = ["breakfast", "brunch", "lunch", "snack", "dinner"];

                // Recopilar informaci√≥n de la tabla
                var tableData = {};
                var table = document.getElementById('planificacion');
                var rows = table.getElementsByTagName('tr');
                for (var i = 1; i < rows.length - 1; i++) {
                    var row = rows[i];
                    var cells = row.getElementsByTagName('td');
                    var meal = meals[i-1]; // Obtener el nombre de la comida usando el √≠ndice
                    tableData[meal.toLowerCase()] = {};
                    for (var j = 1; j < cells.length; j++) {
                        var day = daysOfWeek[j-1]; // Obtener el nombre del d√≠a usando el √≠ndice
                        tableData[meal.toLowerCase()][day] = cells[j].innerText;
                    }
                }
                */
                let daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                let meals = ["breakfast", "brunch", "lunch", "snack", "dinner"];

                // Recopilar informaci√≥n de la tabla
                let tableData = {};
                let table = document.getElementById('planificacion');
                let rows = table.getElementsByTagName('tr');
                for (let j = 1; j < rows[0].cells.length; j++) {
                    let day = daysOfWeek[j-1]; // Obtener el nombre del d√≠a usando el √≠ndice
                    tableData[day.toLowerCase()] = {};
                    //-2 because the last two are total and algorithm
                    for (let i = 1; i < rows.length - 2; i++) {
                        let row = rows[i];
                        let cells = row.getElementsByTagName('td');
                        let meal = meals[i-1]; // Obtener el nombre de la comida usando el √≠ndice
                        //alert(meal)
                        tableData[day.toLowerCase()][meal.toLowerCase()] = cells[j].id//cells[j].innerText;
                    }
                }
                //console.log(user.allIngredients)
                //alert(user.allIngredients)


                // Construir el objeto JSON
                var jsonData = {
                    menu: tableData,
                    profile: formData,
                    shopping: user.allIngredients
                };

                console.log(jsonData)

                // Enviar la solicitud HTTP POST
                fetch(`https://jsonfileapi.onrender.com/${currentUser}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Data saved successfully:', data);
                    // Hacer algo con la respuesta si es necesario


                    document.getElementById('copyBtn').disabled = false;
                    document.getElementById('copyBtn').style.background = '#FF9CCA';

                    //alert("Guardado!")

                    hideSpinner();
                })
                .catch(error => {
                    console.error('Error saving data:', error);
                });

                document.getElementById('saveBtn').disabled = true;
                document.getElementById('saveBtn').style.background = 'lightgray';


            }

            function copy() {
                // L√≥gica para el bot√≥n "Copiar"
                console.log('Copiando...');

                showSpinner();

                let daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                let meals = ["breakfast", "brunch", "lunch", "snack", "dinner"];

                // Recopilar informaci√≥n de la tabla
                let tableData = {};
                let table = document.getElementById('planificacion');
                let rows = table.getElementsByTagName('tr');
                for (let j = 1; j < rows[0].cells.length; j++) {
                    let day = daysOfWeek[j-1]; // Obtener el nombre del d√≠a usando el √≠ndice
                    tableData[day.toLowerCase()] = {};
                    //-2 because the last two are total and algorithm
                    for (let i = 1; i < rows.length - 2; i++) {
                        let row = rows[i];
                        let cells = row.getElementsByTagName('td');
                        let meal = meals[i-1]; // Obtener el nombre de la comida usando el √≠ndice
                        //alert(meal)
                        tableData[day.toLowerCase()][meal.toLowerCase()] = cells[j].id//cells[j].innerText;
                    }
                }
                
                // Construir el objeto JSON
                var jsonData = {
                    menu: tableData,
                    profile: complement.profile,
                    shopping: user.allIngredients
                };

                console.log(jsonData)

                // Enviar la solicitud HTTP POST
                fetch(complementUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Data copied successfully:', data);
                    // Hacer algo con la respuesta si es necesario
                    console.log("Copiado!")

                    if(currentUser === 'a' ){
                        document.getElementById('radio2').click();

                    } else {
                        document.getElementById('radio3').click();
                    }

                    hideSpinner();
                })
                .catch(error => {
                    console.error('Error saving data:', error);
                });
                
                //document.getElementById('saveBtn').disabled = true;
                document.getElementById('copyBtn').disabled = true;
                //document.getElementById('saveBtn').style.background = 'lightgray';
                document.getElementById('copyBtn').style.background = 'lightgray';



            }

            function makeRequest(url, callback) {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", url, true);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);

                        // Llama al callback con la respuesta como argumento
                        callback(response);

                        
                    }
                };
                xhr.send();
            }
        
            function fillForm(profile) {

                document.getElementById('edad').value = profile.age;
                document.getElementById('altura').value = profile.height;
                document.getElementById('peso').value = profile.weight;
                document.getElementById('sexo').value = profile.sex;
                document.getElementById('ejercicio').value = profile.exercise;
                document.getElementById('objetivo').value = profile.objective;

                calcularCalorias();
                
            }

            function clearAll() {
                allAditionalIngredients = null;

                document.getElementById('edad').value = "30";
                document.getElementById('altura').value = "150";
                document.getElementById('peso').value = "50";
                document.getElementById('sexo').value = "mujer";
                document.getElementById('ejercicio').value = "sedentario";
                document.getElementById('objetivo').value = "mantener";
                //document.getElementById('resultado').innerText = "Calcular";
                document.getElementById("caloriasRequeridas").textContent = "Calcular";

                // L√≥gica para limpiar el formulario
                console.log('Formulario limpiado.');
                // Ocultar los botones cuando se selecciona el primer radio button
                //document.getElementById('button-container').style.display = 'none';
                document.getElementById('saveBtn').style.visibility = 'hidden';
                document.getElementById('copyBtn').style.visibility = 'hidden';

                document.getElementById('acList').style.display = 'none';
                document.getElementById('acAlgorithmList').style.display = 'none';

                cleanTable();

                document.getElementById('calculoRequerimiento').submit();//submit
                
            }
            
            function cleanTable(){
                // Limpiar tabla
                let daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                let table = document.getElementById("planificacion").getElementsByTagName("tbody")[0];
                let meals = ["breakfast", "brunch", "lunch", "snack", "dinner"];

                for (var i = 0; i < meals.length; i++) {
                    var meal = meals[i];
                    var row = table.rows[i];
                    var cells = row.cells;
                    //cells[0].textContent = meal.charAt(0).toUpperCase() + meal.slice(1); // Capitalize the meal name
                    for (var j = 0; j < daysOfWeek.length; j++) {
                        var day = daysOfWeek[j];
                        cells[j + 1].textContent = "";
                        cells[j + 1].id = "";
                    }
                }
            }

            function fillTable(menu) {
                let daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
                let table = document.getElementById("planificacion").getElementsByTagName("tbody")[0];
                let meals = ["breakfast", "brunch", "lunch", "snack", "dinner"];

                for (var i = 0; i < meals.length; i++) {
                    var meal = meals[i];
                    //var row = table.rows[i];
                    var row = table.rows[i];//+1 // Start from the second row (index 1) to skip the header row

                    var cells = row.cells;
                    //cells[0].textContent = meal.charAt(0).toUpperCase() + meal.slice(1); // Capitalize the meal name
                    for (var j = 0; j < daysOfWeek.length; j++) {
                        var day = daysOfWeek[j];
                        //cells[j + 1].textContent = menu[day][meal];
                        //
                        

                        let cell = cells[j + 1];// // Start from the second cell (index 1) to skip the meal name cell
                        let recipeName = menu[day][meal];

                        cell.textContent = recipeName;

                        
                        //alert(`${day}  ${meal} ${recipeName}`)
                        if (recipeName) {
                            let recipe = recipes.find(recipe => recipe.name === recipeName);
                            if (recipe) {
                                // Mostrar el nombre de la receta en la celda
                                cell.innerHTML = `<strong>${recipe.name}</strong><br><br>`;

                                // Crear una lista no ordenada para los ingredientes
                                const ingredientsList = document.createElement('ul');
                                ingredientsList.style.fontSize = '50%'; // Establecer el tama√±o de fuente al 50% del tama√±o del nombre de la receta
                                ingredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separaci√≥n vertical m√°s peque√±a

                                // Agregar cada ingrediente a la lista original
                                recipe.ingredients.forEach(ingredient => {
                                    const listItem = document.createElement('li');
                                    listItem.style.marginBottom = '0px'; 
                                    listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                                    ingredientsList.appendChild(listItem);
                                });

                                // Agregar la lista original de ingredientes debajo del nombre de la receta
                                cell.appendChild(ingredientsList);

                                // Agregar un salto de l√≠nea entre las dos listas
                                cell.appendChild(document.createElement('br'));

                                // Crear una segunda lista de ingredientes
                                const secondIngredientsList = document.createElement('ul');
                                secondIngredientsList.style.fontSize = '50%'; // Establecer el tama√±o de fuente al 50% del tama√±o del nombre de la receta
                                secondIngredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separaci√≥n vertical m√°s peque√±a

                                // Agregar cada ingrediente a la segunda lista
                                recipe.ingredients.forEach(ingredient => {
                                    const listItem = document.createElement('li');
                                    listItem.style.marginBottom = '0px'; 
                                    listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                                    secondIngredientsList.appendChild(listItem);
                                });

                                // Agregar la segunda lista de ingredientes debajo de la lista original
                                cell.appendChild(secondIngredientsList);

                                // Al hacer clic en una receta, mostrarla en la celda correspondiente
                                cell.id = recipe.name;
                            }
                        }
                        /**/

                    }
                }
            }
        </script>

        <script>
            var user;
            function calcularCalorias() {

                var edad = parseInt(document.getElementById('edad').value);
                var sexo = document.getElementById('sexo').value;
                var peso = parseInt(document.getElementById('peso').value);
                var altura = parseInt(document.getElementById('altura').value);
                var ejercicio = document.getElementById('ejercicio').value;
                var objetivo = document.getElementById('objetivo').value;

                var tmb;
                if (sexo === 'hombre') {
                    tmb = (10 * peso) + (6.25 * altura) - (5 * edad) + 5;
                } else {
                    tmb = (10 * peso) + (6.25 * altura) - (5 * edad) - 161;
                }

                var factorEjercicio;
                switch (ejercicio) {
                    case 'sedentario':
                        factorEjercicio = 1.2;
                        break;
                    case 'ligero':
                        factorEjercicio = 1.375;
                        break;
                    case 'moderado':
                        factorEjercicio = 1.55;
                        break;
                    case 'fuerte':
                        factorEjercicio = 1.725;
                        break;
                    case 'profesional':
                        factorEjercicio = 1.9;
                        break;
                }

                var totalCalorias = tmb * factorEjercicio;

                if (objetivo === 'bajar') {
                    totalCalorias *= 0.85;
                } else if (objetivo === 'aumentar') {
                    totalCalorias *= 1.15;
                }

                //console.log(totalCalorias.toFixed(2))
                //alert(totalCalorias.toFixed(2))
                //document.getElementById('resultado').innerText = 'Calor√≠as diarias necesarias: ' + totalCalorias.toFixed(2);
                document.getElementById("caloriasRequeridas").textContent = `${totalCalorias.toFixed(2)} Kcal`;
                
                // Example instantiation:
                user = new User(edad, sexo, peso, altura, ejercicio, objetivo, totalCalorias.toFixed(2));

                //document.getElementById("planificacion").enable = false;
                document.getElementById('planificacion').classList.remove('disabled');

                updateTotals();
            }
        </script>
        <script>
            var currentCell;
            const searchInput = document.getElementById('recipe-search');
            const categorySelect = document.getElementById('recipe-category');
            const recipeList = document.getElementById('recipe-list');

            // Agregar event listener para el campo de b√∫squeda
            searchInput.addEventListener('input', function() {
                const searchText = searchInput.value.toLowerCase(); // Convertir el texto a min√∫sculas
                const category = categorySelect.value; // Obtener el valor de la categor√≠a seleccionada
                
                // Filtrar las recetas seg√∫n el texto de b√∫squeda y la categor√≠a seleccionada
                const filteredRecipes = recipes.filter(recipe => {
                    const nameMatch = recipe.name.toLowerCase().includes(searchText); // Verificar si el nombre de la receta coincide con el texto de b√∫squeda
                    const categoryMatch = category === 'All' || recipe.category === category; // Verificar si la categor√≠a coincide con la categor√≠a seleccionada o si se seleccion√≥ "Todas las recetas"
                    return nameMatch && categoryMatch; // Devolver true si tanto el nombre como la categor√≠a coinciden
                });

                // Mostrar las recetas filtradas en la lista
                displayRecipes(filteredRecipes);
            });

            // Agregar event listener para el selector de categor√≠a
            categorySelect.addEventListener('change', function() {
                const searchText = searchInput.value.toLowerCase(); // Obtener el texto de b√∫squeda actual
                const category = categorySelect.value; // Obtener el valor de la categor√≠a seleccionada
                
                // Filtrar las recetas seg√∫n el texto de b√∫squeda y la categor√≠a seleccionada
                const filteredRecipes = recipes.filter(recipe => {
                    const nameMatch = recipe.name.toLowerCase().includes(searchText); // Verificar si el nombre de la receta coincide con el texto de b√∫squeda
                    const categoryMatch = category === 'All' || recipe.category === category; // Verificar si la categor√≠a coincide con la categor√≠a seleccionada o si se seleccion√≥ "Todas las recetas"
                    return nameMatch && categoryMatch; // Devolver true si tanto el nombre como la categor√≠a coinciden
                });

                // Mostrar las recetas filtradas en la lista
                displayRecipes(filteredRecipes);
            });

            // Funci√≥n para mostrar las recetas en la lista
            function displayRecipes(recipes) {
                recipeList.innerHTML = ''; // Limpiar la lista de recetas

                // Agregar cada receta filtrada a la lista
                recipes.forEach(recipe => {
                    const listItem = document.createElement('li');
                    listItem.textContent = recipe.name;
                    listItem.addEventListener('click', function() {
                        // L√≥gica para mostrar la receta seleccionada
                        showRecipeInCell(currentCell, recipe);

                        closeModal();
                        
                        generateInstructionsAndIngredients();//!!!!!!
                        updateTotals();
                    });
                    recipeList.appendChild(listItem);
                });
            }


            function showRecipeModal(cell, rowCategory) {
                currentCell = cell;
                const modal = document.getElementById('modal');

                // Limpiar la lista de recetas
                recipeList.innerHTML = '';

                // Filtrar las recetas por categor√≠a
                categorySelect.value = rowCategory;
                const category = categorySelect.value;
                const filteredRecipes = category === 'All' ? recipes : recipes.filter(recipe => recipe.category === category);

                // Filtrar las recetas por nombre
                const searchQuery = searchInput.value.toLowerCase().trim();
                const searchedRecipes = searchQuery ? filteredRecipes.filter(recipe => recipe.name.toLowerCase().includes(searchQuery)) : filteredRecipes;

                // Agregar cada receta a la lista
                // searchedRecipes.forEach(recipe => {
                //     const listItem = document.createElement('li');
                //     listItem.textContent = recipe.name;
                //     listItem.addEventListener('click', function() {
                //         // Mostrar la receta seleccionada en la celda
                //         showRecipeInCell(cell, recipe);

                //         closeModal();
                        
                //         generateInstructionsAndIngredients();//!!!!!!
                //         updateTotals();
                //     });
                //     recipeList.appendChild(listItem);
                // });
                // Mostrar todas las recetas al cargar la ventana modal
                displayRecipes(searchedRecipes);

                // Mostrar la ventana modal
                modal.style.display = 'block';
            }

            // Funci√≥n para mostrar la receta seleccionada en la celda
            function showRecipeInCell(cell, recipe) {
                // Limpiar la celda
                cell.innerHTML = '';

                // Mostrar el nombre de la receta en la celda
                cell.innerHTML = `<strong>${recipe.name}</strong><br><br>`;

                // Crear una lista no ordenada para los ingredientes
                const ingredientsList = document.createElement('ul');
                ingredientsList.style.fontSize = '50%'; // Establecer el tama√±o de fuente al 50% del tama√±o del nombre de la receta
                ingredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separaci√≥n vertical m√°s peque√±a

                // Agregar cada ingrediente a la lista original
                recipe.ingredients.forEach(ingredient => {
                    const listItem = document.createElement('li');
                    listItem.style.marginBottom = '0px';
                    listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                    ingredientsList.appendChild(listItem);
                });

                // Agregar la lista original de ingredientes debajo del nombre de la receta
                cell.appendChild(ingredientsList);

                // Agregar un salto de l√≠nea entre las dos listas
                cell.appendChild(document.createElement('br'));

                // Crear una segunda lista de ingredientes
                const secondIngredientsList = document.createElement('ul');
                secondIngredientsList.style.fontSize = '50%'; // Establecer el tama√±o de fuente al 50% del tama√±o del nombre de la receta
                secondIngredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separaci√≥n vertical m√°s peque√±a

                // Agregar cada ingrediente a la segunda lista
                recipe.ingredients.forEach(ingredient => {
                    const listItem = document.createElement('li');
                    listItem.style.marginBottom = '0px';
                    listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                    secondIngredientsList.appendChild(listItem);
                });

                // Agregar la segunda lista de ingredientes debajo de la lista original
                cell.appendChild(secondIngredientsList);

                // Al hacer clic en una receta, mostrarla en la celda correspondiente
                cell.id = recipe.name;

                // Habilitar el bot√≥n de guardar
                document.getElementById('saveBtn').disabled = false;
                document.getElementById('saveBtn').style.background = '#FF9CCA';

                // Cerrar la ventana modal
                //closeModal();
            }

            // Funci√≥n para cerrar la ventana modal
            function closeModal() {
                var modal = document.getElementById("modal");
                modal.style.display = "none";
            }

            // Funci√≥n para limpiar la celda de la tabla
            function clearTableCell() {
                currentCell.innerHTML = '';
                currentCell.id = '';
                closeModal();

                document.getElementById('saveBtn').disabled = false;
                document.getElementById('copyBtn').disabled = true;
                document.getElementById('saveBtn').style.background = '#FF9CCA';
                document.getElementById('copyBtn').style.background = 'lightgray';
                
                generateInstructionsAndIngredients();//!!!!!!
                //calcularCalorias();//updatesTotals
                updateTotals();
            }

            /*
            // Funci√≥n para mostrar la ventana modal con la lista de recetas
            function showRecipeModal(cell) {
                // Obtener el valor de la celda
                //var cellValue = cell.textContent.trim();
            
                // Actualizar el contenido de la ventana modal con el valor de la celda
                // var modalContent = modal.querySelector('.modal-content');
                // modalContent.innerHTML = '<span class="close" onclick="closeModal()">&times;</span><p>Contenido de la celda: ' + cellValue + '</p>';

                const modal = document.getElementById('modal');
                const recipeList = document.getElementById('recipe-list');

                // Limpiar la lista de recetas
                recipeList.innerHTML = '';

                // Agregar cada receta a la lista
                recipes.forEach(recipe => {
                    const listItem = document.createElement('li');
                    listItem.textContent = recipe.name;
                    listItem.addEventListener('click', function() {
                        
                        // // Mostrar el nombre de la receta en la celda
                        // cell.innerHTML = `<strong>${recipe.name}</strong><br><br>`;

                        // // Mostrar los ingredientes debajo del nombre de la receta
                        // // recipe.ingredients.forEach(ingredient => {
                        // //     cell.innerHTML += `${ingredient.portion} ${ingredient.unit} de ${ingredient.name}<br>`;
                        // // });
                        
                        // // Crear una lista no ordenada para los ingredientes
                        // const ingredientsList = document.createElement('ul');
                        // ingredientsList.style.fontSize = '50%'; // Establecer el tama√±o de fuente al 50% del tama√±o del nombre de la receta

                        // // Agregar cada ingrediente a la lista
                        // recipe.ingredients.forEach(ingredient => {
                        //     const listItem = document.createElement('li');
                        //     listItem.textContent = `${ingredient.portion} ${ingredient.unit} de ${ingredient.name}`;
                        //     ingredientsList.appendChild(listItem);
                        // });

                        // // Agregar la lista de ingredientes debajo del nombre de la receta
                        // cell.appendChild(ingredientsList);
                        // Mostrar el nombre de la receta en la celda
                        cell.innerHTML = `<strong>${recipe.name}</strong><br><br>`;

                        // Crear una lista no ordenada para los ingredientes
                        const ingredientsList = document.createElement('ul');
                        ingredientsList.style.fontSize = '50%'; // Establecer el tama√±o de fuente al 50% del tama√±o del nombre de la receta
                        ingredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separaci√≥n vertical m√°s peque√±a

                        // Agregar cada ingrediente a la lista original
                        recipe.ingredients.forEach(ingredient => {
                            const listItem = document.createElement('li');
                            listItem.style.marginBottom = '0px'; 
                            listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                            ingredientsList.appendChild(listItem);
                        });

                        // Agregar la lista original de ingredientes debajo del nombre de la receta
                        cell.appendChild(ingredientsList);

                        // Agregar un salto de l√≠nea entre las dos listas
                        cell.appendChild(document.createElement('br'));

                        // Crear una segunda lista de ingredientes
                        const secondIngredientsList = document.createElement('ul');
                        secondIngredientsList.style.fontSize = '50%'; // Establecer el tama√±o de fuente al 50% del tama√±o del nombre de la receta
                        secondIngredientsList.style.marginBottom = '5px'; // Establecer el margen inferior para una separaci√≥n vertical m√°s peque√±a

                        // Agregar cada ingrediente a la segunda lista
                        recipe.ingredients.forEach(ingredient => {
                            const listItem = document.createElement('li');
                            listItem.style.marginBottom = '0px'; 
                            listItem.textContent = `${ingredient.portion.toFixed(2)} ${ingredient.unit} de ${ingredient.name}`;
                            secondIngredientsList.appendChild(listItem);
                        });

                        // Agregar la segunda lista de ingredientes debajo de la lista original
                        cell.appendChild(secondIngredientsList);


                        // Al hacer clic en una receta, mostrarla en la celda correspondiente
                        cell.id = recipe.name;

                        document.getElementById('saveBtn').disabled = false;
                        //document.getElementById('copyBtn').disabled = false;
                        document.getElementById('saveBtn').style.background = '#FF9CCA';
                        //document.getElementById('copyBtn').style.background = '#FF9CCA';

                        //cell.textContent = recipe.name;
                        closeModal();
                        generateInstructionsAndIngredients();//!!!!!!
                        updateTotals();
                    });
                    recipeList.appendChild(listItem);
                });

                // Mostrar la ventana modal
                modal.style.display = 'block';
            }*/
            
            // Funci√≥n para cerrar la ventana modal
            // function closeModal() {
            //     var modal = document.getElementById("modal");
            //     modal.style.display = "none";
            // }
            
            // Cerrar la ventana modal al hacer clic fuera de ella
            window.onclick = function(event) {
                var modal = document.getElementById("myModal");
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        </script>
        <script>

            function generateInstructionsAndIngredients() {
                let allInstructions = []; // Lista de instrucciones √∫nica
                let allIngredients = {}; // Objeto para almacenar ingredientes

                // Recorrer la tabla de planificaci√≥n
                let table = document.getElementById("planificacion").getElementsByTagName("tbody")[0];
                let rows = table.getElementsByTagName("tr");
                for (let i = 0; i < rows.length - 1; i++) { // Ignorar la √∫ltima fila (Total)
                    let cells = rows[i].getElementsByTagName("td");
                    for (let j = 1; j < cells.length; j++) {
                        //let recipeName = cells[j].textContent.trim();
                        //let recipeName = cells[j].querySelector('strong').textContent.trim();
                        let recipeName = cells[j].id
                        //(recipeName)
                        if (recipeName !== "") { // Verificar si hay una receta
                            // Buscar la receta en la lista de recetas
                            let recipe = recipes.find(recipe => recipe.name === recipeName);
                            if (recipe) {
                                // Agregar instrucciones de la receta a la lista de instrucciones √∫nicas
                                if (recipe.preparation && !allInstructions.includes(`${recipe.name}: ${recipe.preparation}`)) {
                                    allInstructions.push(`${recipe.name}: ${recipe.preparation}`);
                                }
                                // Sumar los ingredientes de la receta
                                recipe.ingredients.forEach(ingredient => {
                                    let key = ingredient.name.toLowerCase(); // Convertir el nombre del ingrediente a min√∫sculas
                                    if (key in allIngredients) {
                                        allIngredients[key].portion += ingredient.portion;
                                    } else {
                                        allIngredients[key] = { portion: ingredient.portion, unit: ingredient.unit };
                                    }
                                });
                            }
                        }
                    }
                }

                //console.log(user.allIngredients)
                user.allIngredients = allIngredients;
                console.log('allAditionalIngredients?')
                console.log(allAditionalIngredients)
                if(allAditionalIngredients){
                    mergedShoppingLists = sumShoppingLists(allAditionalIngredients, user.allIngredients)
                }
                //alert(user.allIngredients)

                // Mostrar las instrucciones en la lista de instrucciones
                let listaInstrucciones = document.getElementById("listaInstrucciones");
                listaInstrucciones.innerHTML = "";
                //listaInstrucciones.innerHTML = "<h2>Lista de Instrucciones</h2>";
                allInstructions.forEach(instruction => {
                    let li = document.createElement("li");
                    //li.textContent = instruction;
                    // Dividir el string en dos partes usando el s√≠mbolo dos puntos como separador
                    const parts = instruction.split(':');

                    // Verificar si se encontr√≥ el s√≠mbolo dos puntos y si se dividi√≥ en dos partes
                    if (parts.length === 2) {
                        // Crear un elemento de texto para la primera parte (en negritas)
                        const text1 = document.createElement('strong');
                        text1.textContent = parts[0].trim() + ':';

                        // Crear un elemento de texto para la segunda parte
                        const text2 = document.createTextNode(parts[1].trim());

                        // Crear un elemento span para envolver los dos textos
                        const span = document.createElement('span');

                        // Agregar los textos al span
                        span.appendChild(text1);
                        span.appendChild(document.createTextNode(' ')); // Agregar un espacio entre los textos
                        span.appendChild(text2);

                        // Agregar el span al elemento de lista
                        li.appendChild(span);
                    } else {
                        // Si no se encontr√≥ el s√≠mbolo dos puntos, agregar el texto como est√°
                        li.textContent = instruction;
                    }
                    //
                    listaInstrucciones.appendChild(li);
                });

                // Mostrar los ingredientes en la lista de compras
                let listaCompras = document.getElementById("listaCompras");
                listaCompras.innerHTML = "";

                //listaCompras.innerHTML = "<h2>Lista de Compras</h2>";
                for (let ingredient in allIngredients) {
                    let li = document.createElement("li");
                    li.textContent = `${allIngredients[ingredient].portion.toFixed(2)} ${allIngredients[ingredient].unit} de ${ingredient}`;
                    listaCompras.appendChild(li);
                }

                console.log('mergedShoppingLists')
                console.log(mergedShoppingLists)
                // Mostrar los ingredientes en la lista de compras
                
                let listaCompras3 = document.getElementById("listaCompras3");
                if(document.getElementById('acList').style.display === 'block'){
                    listaCompras3.innerHTML = "";
                    //listaCompras.innerHTML = "<h2>Lista de Compras</h2>";
                    for (let ingredient in mergedShoppingLists) {
                        let li = document.createElement("li");
                        li.textContent = `${mergedShoppingLists[ingredient].portion.toFixed(2)} ${mergedShoppingLists[ingredient].unit} de ${ingredient}`;
                        listaCompras3.appendChild(li);
                    }
                }

            }

        </script>
        <!-- Script externo -->
        <script src="js/models/recipe.js"></script>
        <script src="js/models/food.js"></script>
        <script src="js/models/group.js"></script>
        <script src="js/models/user.js"></script>

        <script src="js/data/groups.js"></script>

        <script src="js/data/recipes/breakfasts.js"></script>
        <script src="js/data/recipes/lunches.js"></script>
        <script src="js/data/recipes/dinners.js"></script>
        <script src="js/data/recipes/snacks.js"></script>
        <script src="js/data/recipes.js"></script>

        <script src="js/data/foods/cerealsAndTubersWithFat.js"></script>
        <script src="js/data/foods/energyFreeFoods.js"></script>
        <script src="js/data/foods/fatFreeCerealsAndTubers.js"></script>
        <script src="js/data/foods/foodsOfAnimalOriginVeryLowInFat.js"></script>
        <script src="js/data/foods/freeConsumptionVegetables.js"></script>
        <script src="js/data/foods/fruitsRichInFiberAndLowInSugar.js"></script>
        <script src="js/data/foods/highEnergyPreparedFoods.js"></script>
        <script src="js/data/foods/highFatAnimalFoods.js"></script>
        <script src="js/data/foods/highSodiumEnergyFreeFoods.js"></script>
        <script src="js/data/foods/legumes.js"></script>
        <script src="js/data/foods/foodsOfAnimalOriginLowInFat.js"></script>
        <script src="js/data/foods/moderateFatAnimalFoods.js"></script>
        <script src="js/data/foods/moderateHighCalciumSkimMilk.js"></script>
        <script src="js/data/foods/moderateHighCalciumWholeMilk.js"></script>
        <script src="js/data/foods/monounsaturatedFatsWithProtein.js"></script>
        <script src="js/data/foods/saturatedAndTransFats.js"></script>
        <script src="js/data/foods/polyunsaturatedFats.js"></script>
        <script src="js/data/foods/sugars.js"></script>
        <script src="js/data/foods/sugarsWithFat.js"></script>
        <script src="js/data/foods/vegetables.js"></script>
        <script src="js/data/foods.js"></script>
    </body>
</html>